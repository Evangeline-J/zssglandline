<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海岸线 - 扫描结果</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400,700" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: transparent;
            color: white;
            font-family: 'Alibaba PuHuiTi', sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .image-container {
            width: auto;
            height: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background-color: transparent;
        }
        
        .composed-image {
            width: 100%;
            height: auto;
            object-fit: contain;
            border: none;
            box-shadow: none;
        }
        
        /* 隐藏加载中的提示，直到图片合成完成 */
        .loading-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            text-align: center;
        }
        
        /* 隐藏Canvas元素 */
        #compositionCanvas {
            display: none;
        }
    </style>
</head>
<body>
    <div class="image-container">
        <img id="composed-image" class="composed-image" alt="Composed Coastline Image" style="display: none;">
        <div id="loading-text" class="loading-text">图片合成中，请稍候...</div>
        <canvas id="compositionCanvas"></canvas>
    </div>
    
    <script>
        // 使用Canvas合成图片并显示
        function composeAndDisplayImage(mainImgSrc, logoImgSrc, coordsText) {
            // 获取Canvas元素
            const canvas = document.getElementById('compositionCanvas');
            const ctx = canvas.getContext('2d');
            
            // 加载主图片
            const mainImg = new Image();
            mainImg.crossOrigin = 'anonymous'; // 允许跨域加载图片
            
            mainImg.onload = function() {
                // 设置canvas尺寸为图片尺寸
                canvas.width = mainImg.width;
                canvas.height = mainImg.height;
                
                // 绘制主图片
                ctx.drawImage(mainImg, 0, 0, canvas.width, canvas.height);
                
                // 加载logo图片
                const logoImg = new Image();
                logoImg.crossOrigin = 'anonymous';
                
                logoImg.onload = function() {
                    // 计算logo位置（左下角）
                    const logoWidth = canvas.width * 0.42; // logo宽度为canvas宽度的42%
                    const logoHeight = logoWidth * (logoImg.height / logoImg.width); // 保持宽高比
                    const logoX = canvas.width * 0.05; // 左边距为canvas宽度的5%
                    const logoY = canvas.height - logoHeight - canvas.height * 0.05; // 底部边距为canvas高度的5%
                    
                    // 绘制logo
                    ctx.drawImage(logoImg, logoX, logoY, logoWidth, logoHeight);
                    
                    // 绘制坐标文本
                    ctx.font = `bold ${canvas.width * 0.05}px 'Alibaba PuHuiTi', sans-serif`;
                    ctx.fillStyle = 'white';
                    ctx.textAlign = 'right';
                    ctx.textBaseline = 'bottom';
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
                    ctx.shadowBlur = 3;
                    ctx.shadowOffsetX = 1;
                    ctx.shadowOffsetY = 1;
                    
                    // 计算文本位置（右下角）
                    const textX = canvas.width - canvas.width * 0.05; // 右边距为canvas宽度的5%
                    const textY = canvas.height - canvas.height * 0.05; // 底部边距为canvas高度的5%
                    
                    // 绘制坐标文本
                    ctx.fillText(coordsText, textX, textY);
                    
                    // 将canvas转换为图片URL
                    const composedImageUrl = canvas.toDataURL('image/jpeg', 0.9);
                    
                    // 显示合成后的图片
                    const composedImage = document.getElementById('composed-image');
                    composedImage.src = composedImageUrl;
                    composedImage.style.display = 'block';
                    
                    // 隐藏加载提示
                    document.getElementById('loading-text').style.display = 'none';
                };
                
                logoImg.src = logoImgSrc;
            };
            
            mainImg.src = mainImgSrc;
        }
        
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 从URL参数中获取数据
            const urlParams = new URLSearchParams(window.location.search);
            const imageUrl = urlParams.get('img');
            const logoUrl = urlParams.get('logo');
            const coords = urlParams.get('coords');
            
            // 解码URL参数
            const decodedImageUrl = imageUrl ? decodeURIComponent(imageUrl) : '';
            const decodedLogoUrl = logoUrl ? decodeURIComponent(logoUrl) : '';
            const decodedCoords = coords ? decodeURIComponent(coords) : '';
            
            // 合成并显示图片
            if (decodedImageUrl && decodedLogoUrl && decodedCoords) {
                composeAndDisplayImage(decodedImageUrl, decodedLogoUrl, decodedCoords);
            } else {
                document.getElementById('loading-text').textContent = '参数不完整，无法显示图片';
            }
        });
    </script>
</body>
</html>
